---
title: "Project Proposal: Diabetes Prevelance by Country, Sex and Year"
output: 
  bookdown::html_document2:
   theme: readable
date: "2023-05-22"
author: Alana Dabelstein 33373973 
---

```{r warning = FALSE, message = FALSE, include = FALSE}
# Load libraries:
library(tidyverse)
library(gridExtra)
library(knitr)
library(plotly)
library(bookdown)
```

# Research Question

The aim of this analysis is to investigate diabetes prevalence over time. The analysis looks at the variables year, country and sex to identify groups with high diabetes prevalence. 

# Dataset Introduction 

The dataset ['DIABETES evolution of diabetes over time'](https://www.ncdrisc.org/data-downloads-diabetes.html) is a global dataset of diabetes prevelance from the years 1980 to 2014 and contains a total of 14,000 observations and 7 variables: 

- "Country/Region/World", 
  - *e.g. "Turkey",  "Bangladesh", "New Zealand"*
- "ISO", 
  - *A region code for international standard denominations for country subdivisions*
- "Sex", 
  - *Two factor variable "Men" or "Women"*
- "Year", 
  - *Ranges from 1980 to 2014*
- "Age-standardised diabetes prevalence", 
  - *Calculated as a percentage*
- "Lower 95% uncertainty interval" and 
- "Upper 95% uncertainty interval". 

**Table 2.1** below shows the first six observations of the full dataset. 


```{r warning=FALSE, message=FALSE}
# Read in Data 
data_full <- read_csv("Data/Diabetes_data.csv")

# create variable of for first observations
data_full_head <- head(data_full)

# display in table
kable(data_full_head, 
             caption = "First Six Observations of the Full Diabetes Dataset",
             digits = 2)

```

# Dataset Description 

The full dataset was reduced to **1000** observations through a random generation of row numbers. The variable "ISO" was removed as it was not necessary for analysis. The reduced data has 6 variables (*Although the limit is 5 variables, I considered the lower and upper 95% confidence interval variables as one variable*). **Figure 3.1** below shows the code used to tidy the full dataset into the reduced dataset. 

```{r include = FALSE}
# Reduce size of Data 

data <- data_full[sample(nrow(data_full), 1000), ] 

data <- data %>%
  select("Country/Region/World", "Sex", "Year", "Age-standardised diabetes prevalence", "Lower 95% uncertainty interval", "Upper 95% uncertainty interval") %>%
  rename(diabetes_prevalence = `Age-standardised diabetes prevalence`, 
         lower_95 = `Lower 95% uncertainty interval`, 
         upper_95 = `Upper 95% uncertainty interval`)

```


```{r fig.cap="Code Screenshot of Data Tidying", fig.align="centre"}
include_graphics("Image/code_screenshot.png")
```

Using the function **str()** the first 2 rows of the data is displayed to show the type of variables in the data set (numeric, character/factor etc.).

```{r}
# first display only first 2 rows
head_data_2 <- head(data,2)

str(head_data_2)
```

# Data Summary {#table2}

Mean and standard deviation were calculated for diabetes prevalence by "Year". **Table 4.1** shows the results of the summary statistics. *This section requires grouping by a factor/character variable. 'Year' is a numerical variable but was chosen here to better reflect the research question*. 

```{r message=FALSE, warning=FALSE}
# group data by year and create summary statistics
data_summary <- data %>%
  group_by(Year) %>%
  summarise(mean_diabetes = mean(diabetes_prevalence), 
            sd_diabetes = sd(diabetes_prevalence), 
            mean_upper95 = mean(upper_95), 
            sd_upper95 = sd(upper_95), 
            mean_lower95 = sd(lower_95), 
            sd_lower95 = sd(lower_95))
```

```{r}
# display only 10 observations (latest years)
tail_data_summary <- tail(data_summary, 10)

# create table
kable(tail_data_summary, 
             caption = "Mean and Standard Deviation of Diabetes Prevalence by Year (First 10 Rows)",
             digits = 3, 
      row_number(10))
```

From **Table 4.1** we can see an increasing trend in mean diabetes prevalence from 2005 to 2014. **2009 had the highest mean** diabetes prevalence at 11.1% from the period 2005 to 2014, but also the **highest standard deviation**. 

# Visualisations {#figure2}

## Diabetes Prevalence Over Time {#DPT}

A figure was created using the ggplot2 R package and the option geom_point(). This is displayed in **Figure 5.1:**

```{r warning=FALSE, message=FALSE, fig.cap="Mean Diabetes Prevalence Increases Over Time", fig.subcap="geom_smooth using method 'loess' and formula 'y ~ x', Red Bars Represent Standard Deviation"}

Figure_2 <- ggplot(data = data_summary, aes(x = Year, y = mean_diabetes)) + 
  geom_point(alpha = 0.7) + 
  xlab("Year") + 
  ylab("Mean Diabetes Prevalence") + 
  theme_minimal() + 
  geom_smooth() + 
  geom_errorbar(aes(ymin=mean_diabetes-sd_diabetes, ymax=mean_diabetes+sd_diabetes), colour="red", alpha=0.3)

ggplotly(Figure_2)
```


- *There is a slight increase in mean diabetes prevalence from 1980 to 2014*
- *The standard deviation bars indicate a high dispersion of data* 

    
## Australian Diabates Trends By Sex {#figure3}

```{r figure3, warning=FALSE, message=FALSE, fig.cap="Men have Higher Risk of Diabetes", fig.subcap="Mean Diabetes Prevalence Has Increased Over Time, geom_smooth using method 'loess' and formula = 'y ~ x' "}

# first filter for australian data
Australia_summary <- data_full %>%
  filter(`Country/Region/World` == "Australia")

Figure_3 <- ggplot(data = Australia_summary, aes(x = Year, y = `Age-standardised diabetes prevalence`, col = Sex)) + 
  geom_point(alpha = 0.8) + 
  xlab("Year") + 
  ylab("Mean Diabetes Prevalence") + 
  theme_minimal() + 
  geom_smooth()

Figure_3

```

Figure 5.2 shows a trend of increasing mean diabates prevalence over time. Men have a noticeably higher mean than women. There is a steep increase from 1980 to 2000 and then a plateau. Data was only available up to 2014. It is unknown whether the plateua begins to trend downwards. 


## Mean Diabetes Prevalence by Country {#table3}

```{r table3, warning=FALSE, message=FALSE}
# filter for five countries and group by sex 
Australia_table_summary <- data_full %>%
  filter(`Country/Region/World` %in% c("Australia", "Germany", "China", "South Africa", "United States of America")) %>%
  select(-ISO) %>%
  group_by(`Country/Region/World`, Sex) %>%
  summarise(`Mean diabetes prevalence` = mean(`Age-standardised diabetes prevalence`))
  
kable(Australia_table_summary, 
             caption = "First Six Observations of the Full Diabetes Dataset",
             digits = 3)
```

Five random countries were selected to compare mean diabetes prevalence by year and sex. In Australia, Germany and United States of America, men have a higher mean diabetes prevalence than women. Mean diabetes prevalence for men and women in China are very similar with men being 0.001 higher. Interestingly, women in South Africa have a higher mean diabetes prevalence than men. 

# Conclusions 

- When grouping diabetes prevalence by year, mean diabates prevalence appears to have a positive trend over time \@ref(figure2). 
  - This positive trend also includes fluctuations over years. 
- 2009 has the highest diabetes prevalence, whereas 1981 has the lowest \@ref(table2). 
  - The standard deviations for each year are high indicating a high dispersion of data. 
- The results for diabetes prevelance over time \@ref(DPT) were calculated from only 1000 entries of a full dataset containing 14,000 entries. 
    - Possible error could be due to the random generation of rows and skew results. 
- Australian men have a higher mean diabetes prevalence than women \@ref(figure3)
- Although Australian men have higher diabetes prevalence, it is not the case for all countries. For example South African women have a higher mean diabetes prevalence than men \@ref(table3). 
- Diabetes can cause life-threatening health complications, therefore identifying high prevalence groups can aid in prevention and treatment. 
    



