---
title: "Project Proposal"
output: html_document
date: "2023-05-22"
---


# Research Question

The aim of this analysis is to investigate diabetes prevalence over time and by country/region. The purpose is to identify countries and years with high diabetes prevalence. 


```{r warning = FALSE, message = FALSE, include = FALSE}
# Load libraries:
library(tidyverse)
library(gridExtra)
library(knitr)
library(plotly)
```

# Dataset Introduction 

The dataset ['DIABETES evolution of diabetes over time'](https://www.ncdrisc.org/data-downloads-diabetes.html) is a global dataset of diabetes prevelance from the years 1980 to 2014 and contains a total of 14,000 observations and 7 variables: 
- "Country/Region/World", 
        - *e.g. "Turkey",  "Bangladesh", "New Zealand"*
- "ISO", 
    - *A region code for international standard denominations for country subdivisions*
- "Sex", 
    - *Two factor variable "Men" or "Women"*
- "Year", 
    - *Ranges from 1980 to 2014*
- "Age-standardised diabetes prevalence", 
    - *Calculated as a percentage*
- "Lower 95% uncertainty interval" and 
- "Upper 95% uncertainty interval". 
**Table 1** below shows the first six observations of the full dataset. 


```{r}
# Read in Data 

data_full <- read_csv("Data/Diabetes_data.csv")

data_full_head <- head(data_full)

kable(data_full_head, 
             caption = "Table 1: First Six Observations of the Full Diabetes Dataset",
             digits = 2)

```

# Dataset Description 

The full dataset was reduced to **1000** observations through a random generation of row numbers. The variable "ISO" was removed as it was not necessary for analysis.** Figure 1** below shows the code used to tidy the full dataset into the reduced dataset. 

```{r include = FALSE}
# Reduce size of Data 

data <- data_full[sample(nrow(data_full), 1000), ] 

data <- data %>%
  select("Country/Region/World", "Sex", "Year", "Age-standardised diabetes prevalence", "Lower 95% uncertainty interval", "Upper 95% uncertainty interval") %>%
  rename(diabetes_prevalence = `Age-standardised diabetes prevalence`, 
         lower_95 = `Lower 95% uncertainty interval`, 
         upper_95 = `Upper 95% uncertainty interval`)

```


```{r fig.cap="Figure 1: Code Screenshot of Data Tidying", fig.align="centre", out.width="50"}
include_graphics("Image/code_screenshot.png")
```

Using the function **str()** the first 2 rows of the data is displayed to show the type of variables in the data set (numeric, character/factor etc.). The assessment requires a maximum of **5** variables, but both the "lower_95" and "upper_95" were kept as they work together. 

```{r}
head_data_2 <- head(data,2)
str(head_data_2)
```

# Data Summary 

Two summary statistics were calculated for diabetes prevalence by "Year". **Table 2** shows the results of the summary statistics. 

```{r include = FALSE}
data_summary <- data %>%
  group_by(Year) %>%
  summarise(mean_diabetes = mean(diabetes_prevalence), 
            sd_diabetes = sd(diabetes_prevalence), 
            mean_upper95 = mean(upper_95), 
            sd_upper95 = sd(upper_95), 
            mean_lower95 = sd(lower_95), 
            sd_lower95 = sd(lower_95))
```

```{r}
tail_data_summary <- tail(data_summary, 10)

kable(tail_data_summary, 
             caption = "Table 2: Mean and Standard Deviation of Diabetes Prevalence by Year (First 10 Rows)",
             digits = 3, 
      row_number(10))
```

From **Table 2** we can see an increasing trend in mean diabetes prevalence from 2005 to 2014. **2009 had the highest mean diabetes prevalence at 11.1% from the period 2005 to 2014, but also the highest standard deviation**. 

# Visualisations 

A figure was created using the ggplot2 R package and the option geom_point(). This is displayed in **Figure 2:**

```{r warning=FALSE, message=FALSE}
Figure_2 <- ggplot(data = data_summary, aes(x = Year, y = mean_diabetes)) + 
  geom_point(alpha = 0.7) + 
  labs(title = "Figure 2: Mean Diabetes Prevalence Increases Over Time", 
       caption = "geom_smooth(` using method = 'loess' and formula = 'y ~ x'",
       subtitle = "Red Bars Represent Standard Deviation") + 
  xlab("Year") + 
  ylab("Mean Diabetes Prevalence") + 
  theme_minimal() + 
  geom_smooth() + 
  geom_errorbar(aes(ymin=mean_diabetes-sd_diabetes, ymax=mean_diabetes+sd_diabetes), colour="red", alpha=0.3)

ggplotly(Figure_2)
```

### Figure 2 Summary 

- *There is a slight increase in mean diabetes prevalence from 1980 to 2014*
- *The standard deviation bars indicate a high dispersion of data* 

# Conclusions 

- When grouping diabetes prevalence by year, mean diabates prevalence appears to have a positive trend over time. 
- This positive trend also includes fluctuations over years. 
- 2009 has the highest diabetes prevalence, whereas 1981 has the lowest. 
- The standard deviations for each year are high indicating a high dispersion of data. 
- The next investigation would be to look at indivudal countries or grouping by sex. 
- These results were also calculated from only 1000 entries of a full dataset containing 14,000 entries. 
    - Possible error could be due to the random generation of rows and skew results. 
    
    
# Australian Diabates Trends By Sex  

```{r figure3, warning=FALSE, message=FALSE}
Australia_summary <- data_full %>%
  filter(`Country/Region/World` == "Australia")

Figure_3 <- ggplot(data = Australia_summary, aes(x = Year, y = `Age-standardised diabetes prevalence`, col = Sex)) + 
  geom_point(alpha = 0.8) + 
  labs(title = "Figure 3: Men have Higher Risk of Diabetes", 
       caption = "geom_smooth(` using method = 'loess' and formula = 'y ~ x'",
       subtitle = "Mean Diabetes Prevalence Has Increased Over Time") + 
  xlab("Year") + 
  ylab("Mean Diabetes Prevalence") + 
  theme_minimal() + 
  geom_smooth()

Figure_3

```

Figure 3 \@ref(figure3) shows a trend of increasing mean diabates prevalence over time. Men have a noticeably higher mean than women. There is a steep increase from 1980 to 2000 and then a plateau. Data was only available up to 2010. It is unknown whether the plateua begins to trend downards. 


# Mean Diabetes Prevalence by Country

```{r table3, warning=FALSE, message=FALSE}
Australia_table_summary <- data_full %>%
  filter(`Country/Region/World` %in% c("Australia", "Germany", "China", "South Africa", "United States of America")) %>%
  select(-ISO) %>%
  group_by(`Country/Region/World`, Sex) %>%
  summarise(`Mean diabetes prevalence` = mean(`Age-standardised diabetes prevalence`))
  
kable(Australia_table_summary, 
             caption = "Table 1: First Six Observations of the Full Diabetes Dataset",
             digits = 3)
```

Five random countries were selected to compare mean diabetes prevalence by year and sex. Table 3 \@ref(table3) presents that in Australia, Germany and United States of America, men have a higher mean diabetes prevalence than women. Mean diabetes prevalence for men and women in China are very similar with men being 0.001 higher. Interestingly, women in South Africa have a higher mean diabetes prevalence than men. 

